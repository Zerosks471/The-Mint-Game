generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// USER DOMAIN
// ============================================================================

model User {
  id                    String    @id @default(uuid())
  email                 String    @unique
  username              String    @unique
  passwordHash          String    @map("password_hash")

  // Profile
  displayName           String?   @map("display_name")
  avatarId              String    @default("avatar_default") @map("avatar_id")
  avatarFrameId         String?   @map("avatar_frame_id")
  badgeId               String?   @map("badge_id")
  bio                   String?
  countryCode           String?   @map("country_code")
  timezone              String    @default("UTC")

  // Account status
  emailVerified         Boolean   @default(false) @map("email_verified")
  emailVerifyToken      String?   @map("email_verify_token")
  accountStatus         String    @default("active") @map("account_status")

  // Security
  passwordResetToken    String?   @map("password_reset_token")
  passwordResetExpires  DateTime? @map("password_reset_expires")
  failedLoginAttempts   Int       @default(0) @map("failed_login_attempts")
  lockedUntil           DateTime? @map("locked_until")
  twoFactorEnabled      Boolean   @default(false) @map("two_factor_enabled")
  twoFactorSecret       String?   @map("two_factor_secret")

  // Preferences
  theme                 String    @default("light")
  soundEnabled          Boolean   @default(true) @map("sound_enabled")
  musicEnabled          Boolean   @default(true) @map("music_enabled")
  notificationsEnabled  Boolean   @default(true) @map("notifications_enabled")
  language              String    @default("en")

  // Premium
  isPremium             Boolean   @default(false) @map("is_premium")
  premiumUntil          DateTime? @map("premium_until")
  stripeCustomerId      String?   @map("stripe_customer_id")

  // Admin
  isAdmin               Boolean   @default(false) @map("is_admin")

  // Onboarding
  tutorialCompleted     Boolean   @default(false) @map("tutorial_completed")
  referralCode          String?   @unique @map("referral_code")
  referredByUserId      String?   @map("referred_by_user_id")

  // Analytics
  signupPlatform        String?   @map("signup_platform")
  signupIp              String?   @map("signup_ip")

  // Timestamps
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  lastLoginAt           DateTime? @map("last_login_at")
  lastActiveAt          DateTime? @map("last_active_at")
  deletedAt             DateTime? @map("deleted_at")

  // Relations
  referredBy            User?     @relation("Referrals", fields: [referredByUserId], references: [id])
  referrals             User[]    @relation("Referrals")
  playerStats           PlayerStats?
  sessions              UserSession[]
  properties            PlayerProperty[]
  businesses            PlayerBusiness[]
  achievements          PlayerAchievement[]
  cosmetics             PlayerCosmetic[]
  subscriptions         Subscription[]
  purchases             Purchase[]
  friendsRequested      Friendship[] @relation("FriendRequester")
  friendsReceived       Friendship[] @relation("FriendAddressee")
  ownedClubs            Club[]       @relation("ClubOwner")
  clubMemberships       ClubMembership[]
  prestigePerks         PlayerPrestigePerk[]
  dailyStreak           PlayerDailyStreak?
  leaderboardEntries    LeaderboardEntry[]
  sentGifts             Gift[]       @relation("SentGifts")
  receivedGifts         Gift[]       @relation("ReceivedGifts")
  notifications         Notification[]
  clubActivities        ClubActivity[]
  ipo                   PlayerIPO?

  @@map("users")
}

model UserSession {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  sessionToken    String    @unique @map("session_token")
  deviceType      String?   @map("device_type")
  deviceName      String?   @map("device_name")
  ipAddress       String?   @map("ip_address")
  userAgent       String?   @map("user_agent")
  isActive        Boolean   @default(true) @map("is_active")
  lastActivityAt  DateTime  @default(now()) @map("last_activity_at")
  expiresAt       DateTime  @map("expires_at")
  revokedAt       DateTime? @map("revoked_at")
  revokeReason    String?   @map("revoke_reason")
  createdAt       DateTime  @default(now()) @map("created_at")

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_sessions")
}

model PlayerStats {
  userId              String    @id @map("user_id")
  cash                Decimal   @default(1000.00) @db.Decimal(24, 2)
  premiumCurrency     Int       @default(0) @map("premium_currency")
  lifetimeCashEarned  Decimal   @default(0) @map("lifetime_cash_earned") @db.Decimal(28, 2)
  playerLevel         Int       @default(1) @map("player_level")
  experiencePoints    Int       @default(0) @map("experience_points")
  prestigeLevel       Int       @default(0) @map("prestige_level")
  prestigePoints      Int       @default(0) @map("prestige_points")
  prestigeMultiplier  Decimal   @default(1.0000) @map("prestige_multiplier") @db.Decimal(6, 4)
  timesPrestiged      Int       @default(0) @map("times_prestiged")
  baseIncomePerHour   Decimal   @default(0) @map("base_income_per_hour") @db.Decimal(20, 2)
  currentMultiplier   Decimal   @default(1.0000) @map("current_multiplier") @db.Decimal(8, 4)
  effectiveIncomeHour Decimal   @default(0) @map("effective_income_hour") @db.Decimal(20, 2)
  lastCollectionAt    DateTime  @default(now()) @map("last_collection_at")
  offlineCapHours     Int       @default(8) @map("offline_cap_hours")
  totalPropertiesOwned Int      @default(0) @map("total_properties_owned")
  totalBusinessesOwned Int      @default(0) @map("total_businesses_owned")
  highestNetWorth     Decimal   @default(0) @map("highest_net_worth") @db.Decimal(24, 2)
  totalPlayTimeMins   Int       @default(0) @map("total_play_time_mins")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("player_stats")
}

// ============================================================================
// PROPERTY DOMAIN
// ============================================================================

model PropertyType {
  id                Int       @id @default(autoincrement())
  slug              String    @unique
  name              String
  description       String?
  iconUrl           String?   @map("icon_url")
  imageUrl          String?   @map("image_url")
  category          String
  tier              Int       @default(1)
  unlockRequirement Json?     @map("unlock_requirement")
  baseCost          Decimal   @map("base_cost") @db.Decimal(20, 2)
  costMultiplier    Decimal   @default(1.15) @map("cost_multiplier") @db.Decimal(8, 4)
  baseIncomeHour    Decimal   @map("base_income_hour") @db.Decimal(16, 2)
  incomeMultiplier  Decimal   @default(1.10) @map("income_multiplier") @db.Decimal(8, 4)
  managerCost       Decimal?  @map("manager_cost") @db.Decimal(18, 2)
  managerName       String?   @map("manager_name")
  maxQuantity       Int       @default(1000) @map("max_quantity")
  maxUpgradeLevel   Int       @default(100) @map("max_upgrade_level")
  sortOrder         Int       @default(0) @map("sort_order")
  isActive          Boolean   @default(true) @map("is_active")
  createdAt         DateTime  @default(now()) @map("created_at")

  playerProperties  PlayerProperty[]

  @@map("property_types")
}

model PlayerProperty {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  propertyTypeId    Int       @map("property_type_id")
  quantity          Int       @default(1)
  totalSpent        Decimal   @default(0) @map("total_spent") @db.Decimal(22, 2)
  upgradeLevel      Int       @default(0) @map("upgrade_level")
  managerHired      Boolean   @default(false) @map("manager_hired")
  managerHiredAt    DateTime? @map("manager_hired_at")
  currentIncomeHour Decimal   @default(0) @map("current_income_hour") @db.Decimal(18, 2)
  nextPurchaseCost  Decimal?  @map("next_purchase_cost") @db.Decimal(20, 2)
  nextUpgradeCost   Decimal?  @map("next_upgrade_cost") @db.Decimal(20, 2)
  skinId            String?   @map("skin_id")
  firstPurchasedAt  DateTime  @default(now()) @map("first_purchased_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  propertyType      PropertyType @relation(fields: [propertyTypeId], references: [id])

  @@unique([userId, propertyTypeId])
  @@map("player_properties")
}

// ============================================================================
// BUSINESS DOMAIN
// ============================================================================

model BusinessType {
  id                Int       @id @default(autoincrement())
  slug              String    @unique
  name              String
  description       String?
  iconUrl           String?   @map("icon_url")
  imageUrl          String?   @map("image_url")
  category          String
  tier              Int       @default(1)
  unlockRequirement Json?     @map("unlock_requirement")
  baseCost          Decimal   @map("base_cost") @db.Decimal(20, 2)
  baseRevenue       Decimal   @map("base_revenue") @db.Decimal(16, 2)
  cycleSeconds      Int       @default(3600) @map("cycle_seconds")
  levelCostMult     Decimal   @default(1.12) @map("level_cost_mult") @db.Decimal(8, 4)
  levelRevenueMult  Decimal   @default(1.08) @map("level_revenue_mult") @db.Decimal(8, 4)
  maxEmployees      Int       @default(10) @map("max_employees")
  employeeBaseCost  Decimal?  @map("employee_base_cost") @db.Decimal(16, 2)
  employeeBonusPct  Decimal   @default(5.00) @map("employee_bonus_pct") @db.Decimal(5, 2)
  maxLevel          Int       @default(200) @map("max_level")
  sortOrder         Int       @default(0) @map("sort_order")
  isActive          Boolean   @default(true) @map("is_active")
  createdAt         DateTime  @default(now()) @map("created_at")

  playerBusinesses  PlayerBusiness[]

  @@map("business_types")
}

model PlayerBusiness {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  businessTypeId    Int       @map("business_type_id")
  level             Int       @default(1)
  totalInvested     Decimal   @default(0) @map("total_invested") @db.Decimal(22, 2)
  employeeCount     Int       @default(0) @map("employee_count")
  currentCycleStart DateTime  @default(now()) @map("current_cycle_start")
  cycleSeconds      Int?      @map("cycle_seconds")
  cyclesCompleted   BigInt    @default(0) @map("cycles_completed")
  totalRevenue      Decimal   @default(0) @map("total_revenue") @db.Decimal(24, 2)
  isAutomated       Boolean   @default(false) @map("is_automated")
  currentRevenue    Decimal   @default(0) @map("current_revenue") @db.Decimal(18, 2)
  nextLevelCost     Decimal?  @map("next_level_cost") @db.Decimal(20, 2)
  purchasedAt       DateTime  @default(now()) @map("purchased_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  businessType      BusinessType @relation(fields: [businessTypeId], references: [id])

  @@unique([userId, businessTypeId])
  @@map("player_businesses")
}

// ============================================================================
// SOCIAL DOMAIN
// ============================================================================

model Friendship {
  id            String    @id @default(uuid())
  requesterId   String    @map("requester_id")
  addresseeId   String    @map("addressee_id")
  status        String    @default("pending")
  requestedAt   DateTime  @default(now()) @map("requested_at")
  respondedAt   DateTime? @map("responded_at")

  requester     User      @relation("FriendRequester", fields: [requesterId], references: [id], onDelete: Cascade)
  addressee     User      @relation("FriendAddressee", fields: [addresseeId], references: [id], onDelete: Cascade)

  @@unique([requesterId, addresseeId])
  @@map("friendships")
}

model Club {
  id              String    @id @default(uuid())
  name            String
  description     String?
  ownerId         String    @map("owner_id")
  isPublic        Boolean   @default(true) @map("is_public")
  memberCount     Int       @default(1) @map("member_count")
  maxMembers      Int       @default(20) @map("max_members")
  clubLevel       Int       @default(1) @map("club_level")
  incomeBonusPct  Decimal   @default(5.00) @map("income_bonus_pct") @db.Decimal(5, 2)
  createdAt       DateTime  @default(now()) @map("created_at")

  owner           User      @relation("ClubOwner", fields: [ownerId], references: [id])
  memberships     ClubMembership[]
  activities      ClubActivity[]

  @@map("clubs")
}

model ClubMembership {
  clubId          String    @map("club_id")
  userId          String    @map("user_id")
  role            String    @default("member")
  status          String    @default("active")
  joinedAt        DateTime  @default(now()) @map("joined_at")

  club            Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([clubId, userId])
  @@map("club_memberships")
}

// ============================================================================
// ACHIEVEMENTS & COSMETICS
// ============================================================================

model Achievement {
  id                String    @id
  name              String
  description       String
  iconUrl           String?   @map("icon_url")
  category          String
  tier              String    @default("bronze")
  points            Int       @default(10)
  requirementType   String    @map("requirement_type")
  requirementValue  Decimal   @map("requirement_value") @db.Decimal(24, 2)
  rewardCash        Decimal   @default(0) @map("reward_cash") @db.Decimal(18, 2)
  rewardPremium     Int       @default(0) @map("reward_premium")
  rewardCosmeticId  String?   @map("reward_cosmetic_id")
  isSecret          Boolean   @default(false) @map("is_secret")
  sortOrder         Int       @default(0) @map("sort_order")
  createdAt         DateTime  @default(now()) @map("created_at")

  playerAchievements PlayerAchievement[]

  @@map("achievements")
}

model PlayerAchievement {
  userId          String    @map("user_id")
  achievementId   String    @map("achievement_id")
  progress        Decimal   @default(0) @db.Decimal(24, 2)
  isCompleted     Boolean   @default(false) @map("is_completed")
  rewardClaimed   Boolean   @default(false) @map("reward_claimed")
  completedAt     DateTime? @map("completed_at")
  claimedAt       DateTime? @map("claimed_at")

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievement     Achievement @relation(fields: [achievementId], references: [id])

  @@id([userId, achievementId])
  @@map("player_achievements")
}

model Cosmetic {
  id              String    @id
  name            String
  description     String?
  type            String
  category        String?
  rarity          String    @default("common")
  previewUrl      String?   @map("preview_url")
  assetUrl        String?   @map("asset_url")
  acquisitionType String    @map("acquisition_type")
  premiumCost     Int?      @map("premium_cost")
  isAvailable     Boolean   @default(true) @map("is_available")
  sortOrder       Int       @default(0) @map("sort_order")
  createdAt       DateTime  @default(now()) @map("created_at")

  playerCosmetics PlayerCosmetic[]

  @@map("cosmetics")
}

model PlayerCosmetic {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  cosmeticId      String    @map("cosmetic_id")
  isEquipped      Boolean   @default(false) @map("is_equipped")
  acquiredVia     String    @map("acquired_via")
  acquiredAt      DateTime  @default(now()) @map("acquired_at")

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  cosmetic        Cosmetic  @relation(fields: [cosmeticId], references: [id])

  @@unique([userId, cosmeticId])
  @@map("player_cosmetics")
}

// ============================================================================
// PAYMENT DOMAIN
// ============================================================================

model Subscription {
  id                    String    @id @default(uuid())
  userId                String    @map("user_id")
  planId                String    @map("plan_id")
  stripeCustomerId      String    @map("stripe_customer_id")
  stripeSubscriptionId  String    @unique @map("stripe_subscription_id")
  status                String
  cancelAtPeriodEnd     Boolean   @default(false) @map("cancel_at_period_end")
  currentPeriodStart    DateTime  @map("current_period_start")
  currentPeriodEnd      DateTime  @map("current_period_end")
  trialStart            DateTime? @map("trial_start")
  trialEnd              DateTime? @map("trial_end")
  canceledAt            DateTime? @map("canceled_at")
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Purchase {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  productType       String    @map("product_type")
  productId         String    @map("product_id")
  productName       String    @map("product_name")
  quantity          Int       @default(1)
  price             Decimal   @db.Decimal(10, 2)
  currency          String    @default("USD")
  paymentMethod     String    @map("payment_method")
  stripePaymentId   String?   @map("stripe_payment_id")
  status            String
  fulfilled         Boolean   @default(false)
  fulfilledAt       DateTime? @map("fulfilled_at")
  createdAt         DateTime  @default(now()) @map("created_at")

  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("purchases")
}

// ============================================================================
// PRESTIGE DOMAIN
// ============================================================================

model PrestigePerk {
  id              String    @id @default(cuid())
  slug            String    @unique
  name            String
  description     String
  category        String    // income, offline, speed, cosmetic
  tier            Int       @default(1)
  cost            Int       // prestige points
  effect          Json      // { type: "income_mult", value: 0.05 }
  maxLevel        Int       @default(1) @map("max_level")
  iconUrl         String?   @map("icon_url")
  sortOrder       Int       @default(0) @map("sort_order")
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")

  playerPerks     PlayerPrestigePerk[]

  @@map("prestige_perks")
}

model PlayerPrestigePerk {
  id            String    @id @default(cuid())
  userId        String    @map("user_id")
  perkId        String    @map("perk_id")
  level         Int       @default(1)
  purchasedAt   DateTime  @default(now()) @map("purchased_at")

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  perk          PrestigePerk  @relation(fields: [perkId], references: [id])

  @@unique([userId, perkId])
  @@map("player_prestige_perks")
}

// ============================================================================
// IPO DOMAIN
// ============================================================================

model PlayerIPO {
  id              String    @id @default(cuid())
  userId          String    @unique @map("user_id")
  tickerSymbol    String    @map("ticker_symbol")
  ipoPrice        Decimal   @db.Decimal(18, 2) @map("ipo_price")
  currentPrice    Decimal   @db.Decimal(18, 2) @map("current_price")
  highPrice       Decimal   @db.Decimal(18, 2) @map("high_price")
  lowPrice        Decimal   @db.Decimal(18, 2) @map("low_price")
  basePoints      Int       @map("base_points")
  trend           String    @default("neutral") // bullish, bearish, neutral
  trendStrength   Int       @default(1) @map("trend_strength") // 1-5
  activeEvent     String?   @map("active_event") // event slug or null
  eventExpiresAt  DateTime? @map("event_expires_at")
  priceHistory    Json      @default("[]") @map("price_history") // [{time, price}]
  lastTickAt      DateTime  @default(now()) @map("last_tick_at")
  tickSeed        Int       @default(0) @map("tick_seed") // For deterministic tick generation
  startsAt        DateTime  @default(now()) @map("starts_at")
  expiresAt       DateTime  @map("expires_at") // 8hr max
  createdAt       DateTime  @default(now()) @map("created_at")

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("player_ipos")
}

model MarketEvent {
  id              String    @id @default(cuid())
  slug            String    @unique
  name            String
  description     String
  effectType      String    @map("effect_type") // trend_bias, instant_spike, tick_modifier
  effectValue     Decimal   @db.Decimal(5, 2) @map("effect_value")
  durationMinutes Int       @map("duration_minutes") // 0 for instant
  isPositive      Boolean   @map("is_positive")
  rarity          Int       @default(1) // 1=common, 2=uncommon, 3=rare
  isActive        Boolean   @default(true) @map("is_active")

  @@map("market_events")
}

// ============================================================================
// DAILY REWARDS DOMAIN
// ============================================================================

model DailyReward {
  day           Int       @id // 1-30
  rewardType    String    @map("reward_type") // cash, premium_currency, boost
  rewardData    Json      @map("reward_data") // { amount: 500 }
  iconUrl       String?   @map("icon_url")

  @@map("daily_rewards")
}

model PlayerDailyStreak {
  userId        String    @id @map("user_id")
  currentStreak Int       @default(0) @map("current_streak")
  longestStreak Int       @default(0) @map("longest_streak")
  lastClaimAt   DateTime? @map("last_claim_at")
  currentDay    Int       @default(1) @map("current_day") // 1-30, cycles back

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("player_daily_streaks")
}

// ============================================================================
// LEADERBOARDS DOMAIN
// ============================================================================

model LeaderboardEntry {
  leaderboardId  String    @map("leaderboard_id")
  userId         String    @map("user_id")
  rank           Int
  previousRank   Int?      @map("previous_rank")
  score          Decimal   @db.Decimal(28, 2)
  username       String?
  displayName    String?   @map("display_name")
  avatarId       String?   @map("avatar_id")
  isPremium      Boolean   @default(false) @map("is_premium")
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at")

  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([leaderboardId, userId])
  @@index([leaderboardId, rank])
  @@map("leaderboard_entries")
}

// ============================================================================
// GIFTS DOMAIN
// ============================================================================

model Gift {
  id            String    @id @default(cuid())
  senderId      String    @map("sender_id")
  receiverId    String    @map("receiver_id")
  giftType      String    @map("gift_type") // cash, boost, cosmetic
  giftData      Json      @map("gift_data") // { amount: 100 }
  message       String?
  status        String    @default("pending") // pending, claimed, expired
  expiresAt     DateTime  @map("expires_at")
  claimedAt     DateTime? @map("claimed_at")
  createdAt     DateTime  @default(now()) @map("created_at")

  sender        User      @relation("SentGifts", fields: [senderId], references: [id], onDelete: Cascade)
  receiver      User      @relation("ReceivedGifts", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("gifts")
}

// ============================================================================
// NOTIFICATIONS DOMAIN
// ============================================================================

model Notification {
  id            String    @id @default(cuid())
  userId        String    @map("user_id")
  type          String    // achievement, friend_request, gift, club
  title         String
  message       String
  data          Json?
  isRead        Boolean   @default(false) @map("is_read")
  createdAt     DateTime  @default(now()) @map("created_at")

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead, createdAt])
  @@map("notifications")
}

// ============================================================================
// CLUB ACTIVITIES DOMAIN
// ============================================================================

model ClubActivity {
  id            String    @id @default(cuid())
  clubId        String    @map("club_id")
  userId        String    @map("user_id")
  activityType  String    @map("activity_type") // joined, donated, leveled_up, earned
  data          Json?
  createdAt     DateTime  @default(now()) @map("created_at")

  club          Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  user          User      @relation(fields: [userId], references: [id])

  @@index([clubId, createdAt])
  @@map("club_activities")
}

// ============================================================================
// EARNINGS HISTORY (for charts/analytics)
// ============================================================================

model EarningsSnapshot {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  snapshotType    String    @map("snapshot_type") // 'hourly', 'daily'
  timestamp       DateTime  @default(now())
  totalCash       Decimal   @map("total_cash") @db.Decimal(24, 2)
  incomePerHour   Decimal   @map("income_per_hour") @db.Decimal(20, 2)
  propertiesOwned Int       @map("properties_owned")
  businessesOwned Int       @map("businesses_owned")
  netWorth        Decimal   @map("net_worth") @db.Decimal(24, 2)
  cashEarned      Decimal   @default(0) @map("cash_earned") @db.Decimal(20, 2) // Earnings since last snapshot
  cashSpent       Decimal   @default(0) @map("cash_spent") @db.Decimal(20, 2)  // Spending since last snapshot

  @@index([userId, snapshotType, timestamp])
  @@map("earnings_snapshots")
}
